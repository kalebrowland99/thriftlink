<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Opening Thrifty…</title>
    <meta name="description" content="Smart redirect to Thrifty with in-app browser handling.">
    <meta property="og:title" content="Thrifty – Smart Redirect" />
    <meta property="og:description" content="Opening Thrifty. If not, tap the button." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://thrifty-tau.vercel.app/" />
    <meta name="robots" content="noindex, nofollow" />
    <style>
        html, body { height: 100%; margin: 0; }
        body { display: grid; place-items: center; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: #0f172a; background: #f8fafc; }
        .card { background: white; padding: 24px 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); text-align: center; max-width: 560px; }
        a { color: #2563eb; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .cta { display: inline-block; margin-top: 8px; padding: 10px 14px; border-radius: 10px; background: #111827; color: white; text-decoration: none; }
        .cta:hover { background: #0b1220; }
        .hidden { display: none; }
		.btn-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 10px; }
		.btn { display: inline-block; padding: 9px 12px; border-radius: 10px; background: #0ea5e9; color: white; text-decoration: none; }
		.btn.secondary { background: #64748b; }
		.btn.destructive { background: #10b981; }
    </style>
</head>
<body>
    <main class="card">
        <h1 style="margin:0 0 8px; font-size: 22px;">Thrifty link test — choose a method</h1>
        <p style="margin:0 0 16px; line-height:1.5;">No auto-redirect here. Try different buttons to see what works best in the TikTok webview.</p>
		<p style="margin:0 0 6px;">
			<a id="cta" class="cta hidden" href="#">Open in your browser</a>
		</p>
		<div id="tiktok-tools" class="hidden">
			<p style="margin:10px 0 8px; font-size:14px; color:#334155;">Using TikTok's in-app browser? Try one of these:</p>
			<div class="btn-row">
				<a id="share-btn" class="btn" href="#">Share → Safari</a>
				<a id="copy-btn" class="btn secondary" href="#">Copy link</a>
				<a id="appstore-btn" class="btn destructive" href="itms-apps://itunes.apple.com/app/id6749215897">Open App Store</a>
			</div>
			<p id="copied-msg" class="hidden" style="margin:8px 0 0; font-size:13px; color:#059669;">Link copied. Paste in Safari if needed.</p>
		</div>
        <hr style="margin:18px 0; border:none; border-top:1px solid #e5e7eb;">
        <p style="margin:0 0 10px; font-size:14px; color:#334155;">Test methods</p>
        <div class="btn-row">
            <a id="m1" class="btn destructive" href="#">Replace → App Store (itms-apps)</a>
            <a id="m2" class="btn" href="#">Href → App Store (https)</a>
            <a id="m3" class="btn secondary" href="#">Open new tab → App Store</a>
            <a id="m4" class="btn" href="#">Top.location → App Store</a>
            <a id="m5" class="btn secondary" href="#">Replace → Vercel bridge</a>
        </div>
    </main>
    <script>
		(function () {
            var baseTargetUrl = 'https://thrifty-tau.vercel.app/';
            var currentQuery = window.location.search || '';
            var currentHash = window.location.hash || '';
            var userAgentString = navigator.userAgent || navigator.vendor || '';

            function buildTargetUrl() {
                var hasQueryOnBase = baseTargetUrl.indexOf('?') !== -1;
                var queryPart = currentQuery ? (hasQueryOnBase ? '&' + currentQuery.slice(1) : currentQuery) : '';
                return baseTargetUrl + queryPart + currentHash;
            }

            var targetUrl = buildTargetUrl();
			var isIOS = /iPhone|iPad|iPod/i.test(userAgentString);
			var isAndroid = /Android/i.test(userAgentString);
			var isTikTok = /TikTok/i.test(userAgentString);
			var isInAppBrowser = /(FBAN|FBAV|Instagram|Line|Twitter|TikTok|Capcut|Messenger|Pinterest|Snapchat|VK|WeChat|Weibo|QQ|MiuiBrowser)/i.test(userAgentString);

            function tryNavigate(url) {
                try { window.location.replace(url); } catch (_) {}
                // Fallback attempt for some in-app browsers
                setTimeout(function () {
                    try { window.location.href = url; } catch (_) {}
                }, 600);
            }

			function revealCta() {
                var cta = document.getElementById('cta');
                if (cta) {
                    cta.classList.remove('hidden');
                    cta.setAttribute('href', targetUrl);
                }
				if (isTikTok) {
					var tools = document.getElementById('tiktok-tools');
					if (tools) tools.classList.remove('hidden');
				}
            }

            // No auto-redirect: bind controls and helpers only
			window.addEventListener('DOMContentLoaded', function () {
                if (isInAppBrowser) {
                    revealCta();
                }

                // Bind explicit user gesture fallback
                var cta = document.getElementById('cta');
                if (cta) {
                    cta.addEventListener('click', function (e) {
                        e.preventDefault();
                        tryNavigate(targetUrl);
                    });
                }

				var shareBtn = document.getElementById('share-btn');
				if (shareBtn) {
					shareBtn.addEventListener('click', function (e) {
						e.preventDefault();
                        if (navigator.share) {
                            navigator.share({ title: 'Open in Safari', text: 'Open in Safari', url: targetUrl }).catch(function () {});
                        } else {
                            tryNavigate(targetUrl);
                        }
					});
				}

				var copyBtn = document.getElementById('copy-btn');
				var copiedMsg = document.getElementById('copied-msg');
				if (copyBtn) {
					copyBtn.addEventListener('click', function (e) {
						e.preventDefault();
						var toCopy = targetUrl;
						if (navigator.clipboard && navigator.clipboard.writeText) {
							navigator.clipboard.writeText(toCopy).then(function () {
								if (copiedMsg) copiedMsg.classList.remove('hidden');
							}).catch(function () {});
                }

				// Test methods
				var appStoreHttps = 'https://apps.apple.com/us/app/thrifty-ai-profit-identifier/id6749215897';
				var appStoreItms = 'itms-apps://itunes.apple.com/app/id6749215897';

				var m1 = document.getElementById('m1');
				if (m1) m1.addEventListener('click', function (e) {
					e.preventDefault();
					var url = isIOS ? appStoreItms : appStoreHttps;
					tryNavigate(url);
				});

				var m2 = document.getElementById('m2');
				if (m2) m2.addEventListener('click', function (e) {
					e.preventDefault();
					try { window.location.href = appStoreHttps; } catch (_) { tryNavigate(appStoreHttps); }
				});

				var m3 = document.getElementById('m3');
				if (m3) m3.addEventListener('click', function (e) {
					e.preventDefault();
					var w = window.open(appStoreHttps, '_blank', 'noopener,noreferrer');
					if (!w) { tryNavigate(appStoreHttps); }
				});

				var m4 = document.getElementById('m4');
				if (m4) m4.addEventListener('click', function (e) {
					e.preventDefault();
					try { top.location.href = appStoreHttps; } catch (_) { tryNavigate(appStoreHttps); }
				});

				var m5 = document.getElementById('m5');
				if (m5) m5.addEventListener('click', function (e) {
					e.preventDefault();
					tryNavigate(targetUrl);
				});
					});
				}
            });
        })();
    </script>
    <noscript>
        Redirecting… If not redirected, use the link above.
    </noscript>
</body>
</html>


